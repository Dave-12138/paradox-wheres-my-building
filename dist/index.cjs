"use strict";const h=require("node:fs"),l=require("node:path"),a=[],n={addConvertTo(...r){a.push(r)},list:a};n.addConvertTo("district_holylight_city","district_holylight_reserve","district_holylight_private","district_holylight_reserve");n.addConvertTo("district_holylight_ring_world_city","district_holylight_ring_world_reserve","district_holylight_ring_world_private","district_holylight_ring_world_public","district_holylight_ring_world_private","district_holylight_ring_world_reserve");n.addConvertTo("district_prostitution_city","district_prostitution_reserve","district_prostitution_private","district_prostitution_public");n.addConvertTo("district_prostitution_ring_world_city","district_prostitution_ring_world_private","district_prostitution_ring_world_reserve","district_prostitution_ring_world_house","district_prostitution_ring_world_public","district_prostitution_ring_world_reserve");const m="/Program Files (x86)/Steam/steamapps/common/Stellaris",y="/Users/Dave/Documents/Paradox Interactive/Stellaris/mod/PWMB",g={gamePath:m,modPath:y},w=l.join(g.gamePath,"common/districts"),f=l.join(g.modPath,"common/districts"),x=["00_special_districts.txt","00_urban_districts.txt","01_arcology_districts.txt","02_rural_districts.txt","03_habitat_districts.txt","04_ringworld_districts.txt","05_wilderness_districts.txt"],d=new RegExp("(?<=convert_to = \\{)[\\s\\w\\n]+(?=\\})");class P{constructor(t){var i,s;if(t instanceof Object)Object.assign(this,t);else if(typeof t=="string"){const o=((i=t.match(/^\w+/))==null?void 0:i[0])??"",c=(s=t.match(d))==null?void 0:s[0].split(`
`).map(e=>e.trim()).filter(e=>e.length>0);this.text=t,this.name=o,this.convert_to=c}this.pos=this._calcPos()}_calcPos(){const t=[["generator","energy"],["mining"],["farming"]];for(let i=1;i<4;i++)if(this._any(s=>s.endsWith("_"+i))||this._any(s=>t[i-1].some(o=>s.includes(o))))return i;return this.text.includes("slot_city_government")?0:-1}get result(){var t;return this.text.replace(d,((t=this.convert_to)==null?void 0:t.reduce((i,s)=>`${i}	${s}
	`,`
	`))??"")}_any(t){var i;return t(this.name)||!!((i=this.convert_to)!=null&&i.some(t))}}const _={};function S(r){var o;const t=h.readFileSync(l.join(w,r),"utf8").replace(/#.*/g,""),i=[],s=new RegExp("(?<=\\n|^)\\w+ = \\{[\\s\\S\\n]+?\\n\\}","g");return(o=t.match(s))==null||o.forEach(c=>i.push(new P(c))),[...t.matchAll(new RegExp("(?<=^|\\n)@(\\w+) = (\\d+)","g"))].forEach(([c,e,v])=>{_[e]===void 0&&(_[e]=v)}),i}const u=x.map(S).flat().filter(r=>!!r.convert_to&&!/potential = \{\n\s+always = no/.test(r.text));u.forEach(r=>n.list.forEach(t=>{var i;t[r.pos]&&((i=r.convert_to)==null||i.push(t[r.pos]??""))}));const p=Object.keys(_).map(r=>`@${r} = ${_[r]}
`).join("")+u.reduce((r,t,i)=>r+t.result+`

`,"");console.log(p);h.writeFileSync(l.join(f,"PWMB_overwrite_districts.txt"),p,{encoding:"utf-8",flag:"w+"});
